---
title: "Salmon Population Dynamics in Washington State"
subtitle: "https://github.com/fekelley4/KelleyLiddle_ENV872_EDA_FinalProject.git"
author: "Fiona Kelley & David Liddle"
date: "2023-12-12"
output: pdf_document
toc: true
---
## Rationale 
Salmon species native to Washington waters are critical components in maintaining economic growth, environmental health, and cultural identities. Salmon fisheries annually generate 23,000 jobs and millions for the State economy from harvest, recreation, and tourism. As a keystone species, salmon support a diverse ecosystem, sustaining 138 wildlife species such as orcas. Additionally, the unique migratory patterns of salmon species facilitates the transport and exchange of nutrients between freshwater and saltwater environments (Washington State Recreation & Conservation Office, 2022).

Salmon species are subject to various anthropogenic and natural stressors due to its exposure to different environments. Within Washington, 14 salmon population groups are listed as threatened or endangered under the Endangered Species Act. Increased water temperatures, as a result of climate change, habitat degradation, infrastructure development, overfishing, and pollution are placing immense pressures on salmon populations; these stressors are limiting breeding grounds, disrupting migration, altering genetic diversity, and depleting fish stocks (Washington State Recreation & Conservation Office, 2022). Utilizing a dataset monitoring the status of salmon fisheries from the Washington Department of Fish and Wildlife, salmon abundance and spawning is examined in relation to temperature and seasonal components. The objective of this analysis is to evaluate changes in counts of live salmon and redds (nests) for Chinook, Coho, and Sockeye salmon, species possessing population groups listed as threatened or endangered under the ESA.  

## Research Questions
Question 1: How has the observation of live salmon and new redd counts changed over the past 50 years? Do certain species exhibit more significant changes in live counts or redd counts compared to others?

Question 2: To what extent do factors such as water temperature and seasonality influence salmon stock counts, and is there variation in these influences between different salmon species?

## Dataset Information 
The selected dataset is a Spawning Ground Survey (SGS) database obtained from the Washington Department of Fish and Wildlife. The enormous survey, possessing 59 columns, contains observations of salmon status from 1930 to present day across Washington State streams. The data is displayed via several organizational methods, including latitude and longitude coordinates, watershed code, stream name, and mileage upstream. The data was collected irregularly, meaning that not every location was sampled on a regular basis, nor was every single component sampled in each event. Thus, the data had to be wrangled carefully, in order to draw meaningful trends from the data.

```{r setup, include=FALSE}
# Importing the necessary packages for data analysis 
library(tidyverse);library(lubridate);library(here);library(ggplot2);
library(cowplot);library(knitr); library(agricolae);library(dplyr)
library(here);library(cowplot)
```

```{r Set Theme, include=FALSE}
# Build ggplot theme
salmon_theme <- theme_classic(base_size = 14) +
theme(axis.text = element_text(color = "black"),
legend.position = "right",
panel.grid.minor = element_line(color = "gray", linetype = "solid"),
panel.grid.major = element_line(color = "gray", linetype = "solid"),
legend.background = element_rect(fill = "gray"))
#Set the theme
theme_set(salmon_theme)
```
## Data Wrangling


```{r Import Data, include=FALSE}
salmon_data <- read.csv(here("Data","Raw","salmon_data.csv"),
  stringsAsFactors = TRUE)
#Add Month column to data
salmon_data$Month <- as.Date(month(salmon_data$SurveyDate))

salmon_chin <- read.csv(here("Data","Processed","ChinookSalmon_ProcessedData.csv"),
  stringsAsFactors = TRUE)
salmon_coho <- read.csv(here("Data","Processed","CohoSalmon_ProcessedData.csv"),
  stringsAsFactors = TRUE)
salmon_sock <- read.csv(here("Data","Processed","SockeyeSalmon_ProcessedData.csv"),
  stringsAsFactors = TRUE)
salmon_live_int <- read.csv(here("Data","Processed","Salmon_ProcessedData_LiveCountInterpolation.csv"),
  stringsAsFactors = TRUE)
salmon_redd_int <- read.csv(here("Data","Processed","Salmon_ProcessedData_NewReddCountInterpolation.csv"),
  stringsAsFactors = TRUE)
chin_data_int <- read.csv(here("Data","Processed","ChinookSalmon_ProcessedData_Interpolation.csv"),
  stringsAsFactors = TRUE)
coho_data_int <- read.csv(here("Data","Processed","CohoSalmon_ProcessedData_Interpolation.csv"),
  stringsAsFactors = TRUE)
sock_data_int <- read.csv(here("Data","Processed","SockeyeSalmon_ProcessedData_Interpolation.csv"),
  stringsAsFactors = TRUE)

```

## Exploratory Analysis 

```{r Total Counts Graphs, include=FALSE}

#Total salmon live count bar graph. 
ggplot(salmon_data, aes(x = RunYear, y = LiveTotal, fill = Species)) +
  geom_bar(stat = "identity", width = 0.9) +
  labs(title = "Total Salmon Live Counts per Year",
       x = "Run Year",
       y = "Total Live Count", 
       fill = "Salmon Species") +
  # Utilized ChatGPT to help format the numbers on the y-axis 
  scale_y_continuous(labels = scales::comma_format(scale = 1e3)) 

#Total redd count bar graph. 
TotalReddPlot <- ggplot(salmon_data, aes(x = RunYear, y = CombinedReddCount, fill = Species)) +
  geom_bar(stat = "identity", width = 0.8) +
  labs(title = "Total New Salmon Redds per Year",
       x = "Run Year",
       y = "Total Redd Count", 
       fill = "Salmon Species") +
  scale_y_continuous(labels = scales::comma_format(scale = 1e3)) 
TotalReddPlot

#Total new redd count bar graph. 
TotalNewReddPlot <- ggplot(salmon_data, aes(x = RunYear, y = NewReddCount, fill = Species)) +
  geom_bar(stat = "identity", width = 0.8) +
  labs(title = "Total New Salmon Redds per Year",
       x = "Run Year",
       y = "Total Redd Count", 
       fill = "Salmon Species") +
  scale_y_continuous(labels = scales::comma_format(scale = 1e3))
TotalNewReddPlot

```

```{r Annual Stream Temperature, include=FALSE}

#Calculate average water temperature. 
AnnualStreamTemp_salmon <- 
  ggplot(salmon_data, aes(x=RunYear, y=WaterTempFarenheit))+
  geom_point(size = 0.7) + 
  labs(title = "Washington Stream Temperature Observations (1973 to 2023)", 
       x = "Year",
       y = "Stream Temperature (Fahrenheit)")
AnnualStreamTemp_salmon

StreamTemp_boxplot <- ggplot(salmon_data, 
aes( x = RunYear, y = WaterTempFarenheit)) +
geom_boxplot(na.rm = TRUE) + 
  #Found this function on ChatGPT, it put the months in correct order
   labs(title = "Washington Stream Temperature (1973 to 2023)", #Create title and label axes
       x = "Year",
       y = "Stream Temperature (Fahrenheit)")
StreamTemp_boxplot

```

## Analysis

```{r Linear Regression for Salmon Counts and Temperature, include=FALSE}
#All Species Linear Regression

#Correlation between live counts and temperature
LiveCounts_Temp<- lm(data = salmon_data, LiveTotal ~ WaterTempFarenheit)
summary(LiveCounts_Temp)
plot(LiveCounts_Temp)
#Plot linear regression
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(LiveCounts_Temp)
par(mfrow = c(1,1))

#Correlation between new redd counts and temperature
NewReddCounts_Temp<- lm(data = salmon_data, NewReddCount ~ WaterTempFarenheit)
summary(NewReddCounts_Temp)
plot(NewReddCounts_Temp)
#Plot linear regression
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(NewReddCounts_Temp)
par(mfrow = c(1,1))

#Chinook Linear Regression

#Correlation between live counts and temperature
LiveCountschin_Temp<- lm(data = salmon_chin, LiveTotal ~ WaterTempFarenheit)
summary(LiveCountschin_Temp)
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(LiveCountschin_Temp)
par(mfrow = c(1,1))

#Correlation between new redd counts and temperature
NewReddCountschin_Temp<- lm(data = salmon_chin, NewReddCount ~ WaterTempFarenheit)
summary(NewReddCountschin_Temp)
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(NewReddCountschin_Temp)
par(mfrow = c(1,1))

#Coho Linear Regression

#Correlation between live counts and temperature
LiveCountscoho_Temp<- lm(data = salmon_coho, LiveTotal ~ WaterTempFarenheit)
summary(LiveCountscoho_Temp)
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(LiveCountscoho_Temp)
par(mfrow = c(1,1))

#Correlation between new redd counts and temperature
NewReddCountscoho_Temp<- lm(data = salmon_coho, NewReddCount ~ WaterTempFarenheit)
summary(NewReddCountscoho_Temp)
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(NewReddCountscoho_Temp)
par(mfrow = c(1,1))

#Sockeye Linear Regression

#Correlation between live counts and temperature
LiveCountssock_Temp<- lm(data = salmon_sock, LiveTotal ~ WaterTempFarenheit)
summary(LiveCountssock_Temp)
#Plot linear regression
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(LiveCountssock_Temp)
par(mfrow = c(1,1))

#Correlation between new redd counts and temperature
NewReddCountssock_Temp<- lm(data = salmon_sock, NewReddCount ~ WaterTempFarenheit)
summary(NewReddCountssock_Temp)
par(mfrow = c(2,2), mar=c(4,4,4,4))
plot(NewReddCountssock_Temp)
par(mfrow = c(1,1))
```

```{r Multiple Regression Analysis for Live Count, include=FALSE}

# Create AIC to determine what set of variables is the live count predictor
TPAIC <- lm(data = salmon_data, LiveTotal ~ WaterTempFarenheit + Month)
step(TPAIC)
# Define the multiple regression model
model <- lm(data = salmon_data, LiveTotal ~ WaterTempFarenheit + Month)

# Fit the model
summary(model)
```

```{r Multiple Regression New Redd Counts}
# Create AIC to determine what set of variables is the live count predictor
TPAIC2 <- lm(data = salmon_data, NewReddCount ~ WaterTempFarenheit + Month)
step(TPAIC2)
# Define the multiple regression model
model2 <- lm(data = salmon_data, NewReddCount ~ WaterTempFarenheit + Month)

# Fit the model
summary(model)

#Because Sockeye New Redd was the only factor with not enough evidence to reject the null, this was because of a lack of temperature data for sockeye salmon
#Run Sockeye New Redd and Live Count Single Regression
#Redd Count
NewReddCountssock_month<- lm(data = salmon_sock, NewReddCount ~ Month)
summary(NewReddCountssock_month)
plot(NewReddCountssock_month)
#Live Count
LiveCountssock_month<- lm(data = salmon_sock, LiveTotal ~ Month)
summary(LiveCountssock_month)
plot(LiveCountssock_month)
```

```{r Salmon Temp Time Series Analysis, include=FALSE}

#Generate time series for monthly average live counts 
f_month <- month(first(salmon_live_int$Month))
f_year <- year(first(salmon_live_int$Year))
salmonlive.monthly.ts <- ts(salmon_live_int$MeanLive,
                   start=c(f_year,f_month),
                   frequency=12)
# Decompose monthly time series
salmon_data_decomp <- stl(salmonlive.monthly.ts, s.window = "periodic")
plot(salmon_data_decomp)
# Run SMK test
salmon_data_trend <- Kendall::SeasonalMannKendall(salmonlive.monthly.ts)
# Inspect results
salmon_data_trend
summary(salmon_data_trend)

#Generate time series for monthly average new redd counts 
f_month <- month(first(salmon_redd_int$Month))
f_year <- year(first(salmon_redd_int$Year))
salmonredd.monthly.ts <- ts(salmon_redd_int$MeanRedd,
                   start=c(f_year,f_month),
                   frequency=12)
# Decompose monthly time series
redd_data_decomp <- stl(salmonredd.monthly.ts, s.window = "periodic")
plot(redd_data_decomp)
# Run SMK test
redd_data_trend <- Kendall::SeasonalMannKendall(salmonredd.monthly.ts)
# Inspect results
redd_data_trend
summary(redd_data_trend)

```

```{r Species Time Series Analysis, include=FALSE}

# Generate time series for Chinook monthly average live counts 
f_month <- month(first(chin_data_int$Month))
f_year <- year(first(chin_data_int$Year))
chin_live.monthly.ts <- ts(chin_data_int$MeanLive,
                   start=c(f_year,f_month),
                   frequency=12)
# Decompose monthly time series
chin_data_decomp <- stl(chin_live.monthly.ts, s.window = "periodic")
plot(chin_data_decomp)
# Run SMK test
chin_live_data_trend <- Kendall::SeasonalMannKendall(chin_live.monthly.ts)
# Inspect results
chin_live_data_trend
summary(chin_live_data_trend)

# Generate time series for Chinook monthly average redd counts 
f_month <- month(first(chin_data_int$Month))
f_year <- year(first(chin_data_int$Year))
chin_redd.monthly.ts <- ts(chin_data_int$MeanRedd,
                   start=c(f_year,f_month),
                   frequency=12)
# Decompose monthly time series
chin_redd_data_decomp <- stl(chin_redd.monthly.ts, s.window = "periodic")
plot(chin_redd_data_decomp)
# Run SMK test
chin_redd_data_trend <- Kendall::SeasonalMannKendall(chin_redd.monthly.ts)
# Inspect results
chin_redd_data_trend
summary(chin_redd_data_trend)

# Generate time series for Coho monthly average live counts 
f_month <- month(first(coho_data_int$Month))
f_year <- year(first(coho_data_int$Year))
coho_live.monthly.ts <- ts(coho_data_int$MeanLive,
                   start=c(f_year,f_month),
                   frequency=12)
# Decompose monthly time series
coho_data_decomp <- stl(coho_live.monthly.ts, s.window = "periodic")
plot(coho_data_decomp)
# Run SMK test
coho_live_data_trend <- Kendall::SeasonalMannKendall(coho_live.monthly.ts)
# Inspect results
coho_live_data_trend
summary(coho_live_data_trend)

# Generate time series for Coho monthly average redd counts 
f_month <- month(first(coho_data_int$Month))
f_year <- year(first(coho_data_int$Year))
coho_redd.monthly.ts <- ts(coho_data_int$MeanRedd,
                   start=c(f_year,f_month),
                   frequency=12)
# Decompose monthly time series
coho_redd_data_decomp <- stl(coho_redd.monthly.ts, s.window = "periodic")
plot(coho_redd_data_decomp)
# Run SMK test
coho_redd_data_trend <- Kendall::SeasonalMannKendall(coho_redd.monthly.ts)
# Inspect results
coho_redd_data_trend
summary(coho_redd_data_trend)

# Generate time series for Sockeye monthly average live counts 
f_month <- month(first(sock_data_int$Month))
f_year <- year(first(sock_data_int$Year))
sock_live.monthly.ts <- ts(sock_data_int$MeanLive,
                   start=c(f_year,f_month),
                   frequency=12)
# Decompose monthly time series
sock_data_decomp <- stl(sock_live.monthly.ts, s.window = "periodic")
plot(sock_data_decomp)
# Run SMK test
sock_live_data_trend <- Kendall::SeasonalMannKendall(sock_live.monthly.ts)
# Inspect results
sock_live_data_trend
summary(sock_live_data_trend)

# Generate time series for Sockeye monthly average redd counts 
f_month <- month(first(sock_data_int$Month))
f_year <- year(first(sock_data_int$Year))
sock_redd.monthly.ts <- ts(sock_data_int$MeanRedd,
                   start=c(f_year,f_month),
                   frequency=12)
# Decompose monthly time series
sock_redd_data_decomp <- stl(sock_redd.monthly.ts, s.window = "periodic")
plot(sock_redd_data_decomp)
# Run SMK test
sock_redd_data_trend <- Kendall::SeasonalMannKendall(sock_redd.monthly.ts)
# Inspect results
sock_redd_data_trend
summary(sock_redd_data_trend)
```

## Summary & Conclusions 

## Works Cited 
