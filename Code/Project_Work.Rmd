---
title: "Final_Project_Work"
author: "David Liddle/Fiona Kelley"
date: "2023-11-25"
output: pdf_document
---

```{r setup, include=FALSE}

library(tidyverse);library(lubridate);library(here);library(ggplot2);
library(cowplot);library(knitr); library(agricolae);library(dplyr)
library(here)
```

```{r Set Theme}
#2 Build ggplot theme
salmon_theme <- theme_classic(base_size = 14) +
theme(axis.text = element_text(color = "black"),
legend.position = "right",
panel.grid.minor = element_line(color = "gray", linetype = "solid"),
panel.grid.major = element_line(color = "gray", linetype = "solid"),
legend.background = element_rect(fill = "gray"))
#Set the theme
theme_set(salmon_theme)
```

```{r Import Wrangled Data}
salmon_data <- read.csv(here("Data","Raw","salmon_data.csv"),
  stringsAsFactors = TRUE)
```

```{r Split Dataset by Species}
salmon_chin <- salmon_data %>% filter(SpeciesAbbr=="CHIN")
salmon_sock <- salmon_data %>% filter(SpeciesAbbr=="SOCK")
salmon_coho <- salmon_data %>% filter(SpeciesAbbr=="COHO")
```

```{r Calculate and Graph Average Count Data}

Average_LiveCount <- salmon_data %>%
  group_by(SpeciesAbbr, RunYear) %>% # Group the data by WRIA and survey date
  summarise(Avg_Live = mean(LiveTotal, na.rm = TRUE))

Average_DeadCount <- salmon_data %>%
  group_by(SpeciesAbbr, RunYear) %>% # Group the data by WRIA and survey date
  summarise(Avg_Dead = mean(DeadTotal, na.rm = TRUE))

Average_CombinedRedd <- salmon_data %>%
  group_by(SpeciesAbbr, RunYear) %>% # Group the data by WRIA and survey date
  summarise(Avg_CombinedRedd = mean(CombinedReddCount, na.rm = TRUE))

Average_NewRedd <- salmon_data %>%
  group_by(SpeciesAbbr, RunYear) %>% # Group the data by WRIA and survey date
  summarise(Avg_NewRedd = mean(NewReddCount, na.rm = TRUE))

ggplot(Average_LiveCount, aes(x = RunYear, y = Avg_Live, fill = SpeciesAbbr)) +
  geom_col(position = "dodge") +
  labs(title = "Average Live Salmon Count from 1973 to 2023",
       x = "Year", y = "Count")

ggplot(Average_DeadCount, aes(x = RunYear, y = Avg_Dead, fill = SpeciesAbbr)) +
  geom_col(position = "dodge") +
  labs(title = "Average Dead Salmon Count from 1973 to 2023",
       x = "Year", y = "Count")

ggplot(Average_CombinedRedd, aes(x = RunYear, y = Avg_CombinedRedd, fill = SpeciesAbbr)) +
  geom_col(position = "dodge") +
  labs(title = "Average Combined Redd Salmon Count from 1973 to 2023",
       x = "Year", y = "Count")

ggplot(Average_NewRedd, aes(x = RunYear, y = Avg_NewRedd, fill = SpeciesAbbr)) +
  geom_col(position = "dodge") +
  labs(title = "Average New Redd Salmon Count from 1973 to 2023",
       x = "Year", y = "Count")

```

```{r Calculate and Graph Average Counts by Species}
#Chinook counts
AverageLive_Chinook <- salmon_chin %>% 
  group_by(RunYear) %>% 
  summarise(Avg_Live = mean(LiveTotal, na.rm = TRUE))

ggplot(AverageLive_Chinook, aes(x = RunYear, y = Avg_Live)) +
  geom_col() +
  labs(title = "Average Live Chinook Salmon Count from 1973 to 2023",
       x = "Year", y = "Count")

AverageNewRedd_Chinook <- salmon_chin %>% 
  group_by(RunYear) %>% 
  summarise(Avg_NewRedd = mean(NewReddCount, na.rm = TRUE))

ggplot(AverageNewRedd_Chinook, aes(x = RunYear, y = Avg_NewRedd)) +
  geom_col() +
  labs(title = "Average New Redd Chinook Salmon Count from 1973 to 2023",
       x = "Year", y = "Count")

#Sockeye counts
AverageLive_Sockeye <- salmon_sock %>% 
  group_by(RunYear) %>% 
  summarise(Avg_Live = mean(LiveTotal, na.rm = TRUE))

ggplot(AverageLive_Sockeye, aes(x = RunYear, y = Avg_Live)) +
  geom_col() +
  labs(title = "Average Live Sockeye Salmon Count from 1973 to 2023",
       x = "Year", y = "Count")

AverageNewRedd_Sockeye <- salmon_sock %>% 
  group_by(RunYear) %>% 
  summarise(Avg_NewRedd = mean(NewReddCount, na.rm = TRUE))

ggplot(AverageNewRedd_Sockeye, aes(x = RunYear, y = Avg_NewRedd)) +
  geom_col() +
  labs(title = "Average New Redd Sockeye Salmon Count from 1973 to 2023",
       x = "Year", y = "Count")

#Coho counts 

AverageLive_Coho <- salmon_coho %>% 
  group_by(RunYear) %>% 
  summarise(Avg_Live = mean(LiveTotal, na.rm = TRUE))

ggplot(AverageLive_Coho, aes(x = RunYear, y = Avg_Live)) +
  geom_col() +
  labs(title = "Average Live Coho Salmon Count from 1973 to 2023",
       x = "Year", y = "Count")

AverageNewRedd_Coho <- salmon_coho %>% 
  group_by(RunYear) %>% 
  summarise(Avg_NewRedd = mean(NewReddCount, na.rm = TRUE))

ggplot(AverageNewRedd_Coho, aes(x = RunYear, y = Avg_NewRedd)) +
  geom_col() +
  labs(title = "Average New Redd Coho Salmon Count from 1973 to 2023",
       x = "Year", y = "Count")

```

```{r Average Annual Temperature}

#Calculate average water temperature. 
AverageAnnualTemp_salmon <- salmon_data %>%
  group_by(RunYear) %>% # Group the data by year
  summarise(Avg_WaterTemp = mean(WaterTempFarenheit, na.rm = TRUE))


```

```{r Linear Regression for Salmon Counts and Temperature}

#Correlation between total counts and temperature 


LiveCounts_Temp<- lm(data = lakechem_select, temperature_C ~ depth)

```


```{r Organize data by Observation Year}
#Sorting for Chinook
# Live Salmon Counts
salmon_chin_live <- salmon_chin %>%
  group_by(RunYear) %>%
  summarize(average_live = mean(LiveTotal))
# Dead Salmon Counts
salmon_chin_dead <- salmon_chin %>%
  group_by(RunYear) %>%
  summarize(average_dead = mean(DeadTotal))
#Merge datasets
Combined_chin <- full_join(salmon_chin_live, salmon_chin_dead)

#Sorting for Sockeye
# Live Salmon Counts
salmon_sock_live <- salmon_sock %>%
  group_by(RunYear) %>%
  summarize(average_live = mean(LiveTotal))
# Dead Salmon Counts
salmon_sock_dead <- salmon_sock %>%
  group_by(RunYear) %>%
  summarize(average_dead = mean(DeadTotal))
#Merge datasets
Combined_sock <- full_join(salmon_sock_live, salmon_sock_dead)

#Sorting for Coho
# Live Salmon Counts
salmon_coho_live <- salmon_coho %>%
  group_by(RunYear) %>%
  summarize(average_live = mean(LiveTotal))
# Dead Salmon Counts
salmon_coho_dead <- salmon_coho %>%
  group_by(RunYear) %>%
  summarize(average_dead = mean(DeadTotal))
#Merge datasets
Combined_coho <- full_join(salmon_coho_live, salmon_coho_dead)

```

```{r Data Reshaping}
#Reshape Data
salmon_chin_long <- gather(Combined_chin, key = "status", value = "count", -RunYear)
salmon_sock_long <- gather(Combined_sock, key = "status", value = "count", -RunYear)
salmon_coho_long <- gather(Combined_coho, key = "status", value = "count", -RunYear)
```

```{r Graphing the Data}
#Plot Chinook Data
ggplot(salmon_chin_long,aes(x=RunYear,y=count, color=status)) + 
  geom_line() +
  labs(title ="Average Live and Dead Chinook Salmon Counts",
       x = "Year",y = "Count", color="Status") +
  scale_color_manual(
    values = c("average_live" = "blue", "average_dead" = "red"),
    labels = c("Dead Count", "Live Count"))
#Plot Sockeye Data
ggplot(salmon_sock_long,aes(x=RunYear,y=count, color=status)) + 
  geom_line() +
  labs(title ="Average Live and Dead Sockeye Salmon Counts",
       x = "Year",y = "Count", color="Status") +
  scale_color_manual(
    values = c("average_live" = "blue", "average_dead" = "red"),
    labels = c("Dead Count", "Live Count"))
#Plot Coho Data
ggplot(salmon_coho_long,aes(x=RunYear,y=count, color=status)) + 
  geom_line() +
  labs(title ="Average Live and Dead Coho Salmon Counts",
       x = "Year",y = "Count", color="Status") +
  scale_color_manual(
    values = c("average_live" = "blue", "average_dead" = "red"),
    labels = c("Dead Count", "Live Count"))

salmon_data_WRIA <- salmon_data_species %>% filter(WRIA %in% c(17,18,19))

ggplot(salmon_data_WRIA, aes(x = RunYear, y = LiveTotal)) +
  geom_point() +
  geom_smooth(method = 'loess', se = FALSE, color="green") +
  labs(title = "Chinook/Coho/Sockeye Salmon Live Counts in Study Area",
       x = "Year", y = "Live Count")
```
```{r Graphing the Data}
#Plot Chinook Data
ggplot(salmon_chin_long,aes(x=RunYear,y=count, color=status)) + 
   geom_point() +
  geom_smooth(method = 'loess', se = FALSE, color="black") +
  labs(title ="Average Live and Dead Chinook Salmon Counts",
       x = "Year",y = "Count", color="Status") +
  scale_color_manual(
    values = c("average_live" = "blue", "average_dead" = "red"),
    labels = c("Dead Count", "Live Count"))
#Plot Sockeye Data
ggplot(salmon_sock_long,aes(x=RunYear,y=count, color=status)) + 
  geom_point() +
  geom_smooth(method = 'loess', se = FALSE, color="black") +
  labs(title ="Average Live and Dead Sockeye Salmon Counts",
       x = "Year",y = "Count", color="Status") +
  scale_color_manual(
    values = c("average_live" = "blue", "average_dead" = "red"),
    labels = c("Dead Count", "Live Count"))
#Plot Coho Data
ggplot(salmon_coho_long,aes(x=RunYear,y=count, color=status)) + 
  geom_point() +
  geom_smooth(method = 'loess', se = FALSE, color="black") +
  labs(title ="Average Live and Dead Coho Salmon Counts",
       x = "Year",y = "Count", color="Status") +
  scale_color_manual(
    values = c("average_live" = "blue", "average_dead" = "red"),
    labels = c("Dead Count", "Live Count"))
```

```{r Temperature Data}
# Temperatures
salmon_data_temp <- salmon_data_species%>%
  select(RunYear,WaterTempFarenheit) %>% na.omit()
# Average Temperatures
salmon_data_temp_avg <- salmon_data_temp%>%
  group_by(RunYear) %>%
  summarize(avg.temp = mean(WaterTempFarenheit))
```

```{r}
install.packages("sf")
library(sf)

data <- st_read(here('WR_WAT_WRIA.gdb'))
library(mapview)
mapView(data)

library(dplyr)

joined_data <- data %>% inner_join(salmon_coding, by = c("WRIA_ID"="WRIA"))

# View the result
print(joined_data)
mapview(joined_data)
data
```


```{r}
```


